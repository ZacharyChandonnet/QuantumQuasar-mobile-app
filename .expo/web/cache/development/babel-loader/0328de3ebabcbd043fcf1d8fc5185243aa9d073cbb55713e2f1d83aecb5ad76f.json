{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useEffect } from 'react';\nimport { setDoc, doc, arrayUnion, arrayRemove, getDoc } from 'firebase/firestore';\nimport { db, auth } from \"../FirebaseConfig.js\";\nimport { Ionicons } from '@expo/vector-icons';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function FavoriteCoin(_ref) {\n  var nftId = _ref.nftId,\n    name = _ref.name,\n    price = _ref.price,\n    image = _ref.image,\n    symbol = _ref.symbol;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isFavorite = _useState2[0],\n    setFavorite = _useState2[1];\n  var _useState3 = useState(),\n    _useState4 = _slicedToArray(_useState3, 2),\n    nftLike = _useState4[0],\n    setNftLike = _useState4[1];\n  var _useState5 = useState(),\n    _useState6 = _slicedToArray(_useState5, 2),\n    nftLikes = _useState6[0],\n    setNftLikes = _useState6[1];\n  useEffect(function () {\n    var fetchUserFavorites = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        var userDoc = yield getDoc(doc(db, 'users', auth.currentUser.uid));\n        if (userDoc.exists()) {\n          var userFavorites = userDoc.data().NftLike || [];\n          var newNftLike = {\n            id: nftId,\n            image: image,\n            name: name,\n            price: price,\n            symbol: symbol\n          };\n          setFavorite(userFavorites.includes(newNftLike));\n          setNftLike(newNftLike);\n        }\n      });\n      return function fetchUserFavorites() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    fetchUserFavorites();\n  }, [nftId]);\n  useEffect(function () {\n    var unsubscribe = auth.onAuthStateChanged(function () {\n      var _ref3 = _asyncToGenerator(function* (user) {\n        if (user) {\n          var userId = user.uid;\n          var userDocRef = doc(db, 'users', userId);\n          var userDocSnapshot = yield getDoc(userDocRef);\n          if (userDocSnapshot.exists()) {\n            var nftsLike = userDocSnapshot.data().NftLike || [];\n            setNftLikes(nftsLike);\n          }\n        }\n      });\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n    return function () {\n      return unsubscribe();\n    };\n  }, []);\n  useEffect(function () {\n    nftLikes.forEach(function (item) {\n      if (item.id === nftId) {\n        setFavorite(true);\n      }\n    });\n  }, [nftLikes, nftId]);\n  var toggleFavorite = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      if (isFavorite) {\n        yield setDoc(doc(db, 'users', auth.currentUser.uid), {\n          NftLike: arrayRemove(nftLike)\n        }, {\n          merge: true\n        });\n      } else {\n        yield setDoc(doc(db, 'users', auth.currentUser.uid), {\n          NftLike: arrayUnion(nftLike)\n        }, {\n          merge: true\n        });\n      }\n      setFavorite(!isFavorite);\n    });\n    return function toggleFavorite() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  return _jsx(TouchableOpacity, {\n    onPress: toggleFavorite,\n    children: _jsx(Ionicons, {\n      style: styles.stars,\n      name: \"star\",\n      size: 24,\n      color: isFavorite ? \"orange\" : \"gray\"\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  stars: {\n    padding: 15\n  }\n});","map":{"version":3,"names":["React","useState","useEffect","setDoc","doc","arrayUnion","arrayRemove","getDoc","db","auth","Ionicons","StyleSheet","TouchableOpacity","jsx","_jsx","FavoriteCoin","_ref","nftId","name","price","image","symbol","_useState","_useState2","_slicedToArray","isFavorite","setFavorite","_useState3","_useState4","nftLike","setNftLike","_useState5","_useState6","nftLikes","setNftLikes","fetchUserFavorites","_ref2","_asyncToGenerator","userDoc","currentUser","uid","exists","userFavorites","data","NftLike","newNftLike","id","includes","apply","arguments","unsubscribe","onAuthStateChanged","_ref3","user","userId","userDocRef","userDocSnapshot","nftsLike","_x","forEach","item","toggleFavorite","_ref4","merge","onPress","children","style","styles","stars","size","color","create","padding"],"sources":["D:/0-ProjetPerso/QuantumQuasar/QuantumQuasar/screens/FavoriteNft.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { setDoc, doc, arrayUnion, arrayRemove, getDoc } from 'firebase/firestore';\r\nimport { db, auth } from '../FirebaseConfig.js';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport { StyleSheet, TouchableOpacity } from 'react-native';\r\n\r\nexport default function FavoriteCoin({ nftId, name, price, image, symbol }) {\r\n    const [isFavorite, setFavorite] = useState(false);\r\n    const [nftLike, setNftLike] = useState();\r\n    const [nftLikes, setNftLikes] = useState();\r\n\r\n    useEffect(() => {\r\n        const fetchUserFavorites = async () => {\r\n            const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));\r\n            if (userDoc.exists()) {\r\n                const userFavorites = userDoc.data().NftLike || [];\r\n                const newNftLike = {\r\n                    id: nftId,\r\n                    image: image,\r\n                    name: name,\r\n                    price: price,\r\n                    symbol: symbol\r\n                }\r\n                setFavorite(userFavorites.includes(newNftLike));\r\n                setNftLike(newNftLike);\r\n            }\r\n        };\r\n\r\n        fetchUserFavorites();\r\n    }, [nftId]);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = auth.onAuthStateChanged(async (user) => {\r\n            if (user) {\r\n                const userId = user.uid;\r\n                const userDocRef = doc(db, 'users', userId);\r\n                const userDocSnapshot = await getDoc(userDocRef);\r\n\r\n                if (userDocSnapshot.exists()) {\r\n                    const nftsLike = userDocSnapshot.data().NftLike || [];\r\n                    setNftLikes(nftsLike);\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // Vous pouvez effectuer le check ici après que nftLikes ait été mis à jour\r\n        nftLikes.forEach((item) => {\r\n            if (item.id === nftId) {\r\n                setFavorite(true);\r\n            }\r\n        });\r\n    }, [nftLikes, nftId]);\r\n\r\n    const toggleFavorite = async () => {\r\n        if (isFavorite) {\r\n            await setDoc(doc(db, 'users', auth.currentUser.uid), {\r\n                NftLike: arrayRemove(nftLike)\r\n            }, { merge: true });\r\n        } else {\r\n            await setDoc(doc(db, 'users', auth.currentUser.uid), {\r\n                NftLike: arrayUnion(nftLike)\r\n            }, { merge: true });\r\n        }\r\n        setFavorite(!isFavorite);\r\n    }\r\n\r\n    return (\r\n        <TouchableOpacity onPress={toggleFavorite}>\r\n            <Ionicons style={styles.stars} name=\"star\" size={24} color={isFavorite ? \"orange\" : \"gray\"} />\r\n        </TouchableOpacity>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    stars: {\r\n        padding: 15,\r\n    },\r\n});\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}